{% extends "base.html" %}

{% block title %}Usuarios | Portal{% endblock title %}

{% block content %}
<div class="d-flex justify-content-between align-items-center mb-3">
  <div>
    <h1 class="h3 mb-1">Administraci√≥n de usuarios</h1>
    <p class="text-muted mb-0">Visualiza y gestiona los usuarios del portal.</p>
  </div>
  {% if es_admin %}
  <a class="btn btn-portal" href="{% url 'usuarios_crear' %}">
    Nuevo usuario
  </a>
  {% endif %}
</div>

<div class="card portal-card">
  <div class="card-body p-0">
    <div class="table-responsive">
      <table class="table align-middle mb-0">
        <thead class="table-light">
          <tr>
            <th>Usuario</th>
            <th>Nombre</th>
            <th>Correo</th>
            <th>Grupo</th>
            <th>Estado</th>
            <th class="text-end">Acciones</th>
          </tr>
        </thead>
        <tbody>
          {% for usuario in usuarios %}
          <tr>
            <td class="fw-semibold">{{ usuario.username }}</td>
            <td>{{ usuario.get_full_name|default:"-" }}</td>
            <td>{{ usuario.email|default:"-" }}</td>
            <td>
              {% with grupos=usuario.groups.all %}
              {% if grupos %}
              {{ grupos|join:", " }}
              {% else %}-{% endif %}
              {% endwith %}
            </td>
            <td>
              {% if usuario.is_active %}
              <span class="badge text-bg-success">Activo</span>
              {% else %}
              <span class="badge text-bg-secondary">Inactivo</span>
              {% endif %}
            </td>
            <td class="text-end">
              <div class="btn-group" role="group">
                <a class="btn btn-sm btn-outline-primary" href="{% url 'usuarios_editar' usuario.pk %}">
                  Editar
                </a>
                {% if es_admin and usuario != request.user %}
                <a class="btn btn-sm btn-outline-danger" href="{% url 'usuarios_eliminar' usuario.pk %}">
                  Eliminar
                </a>
                {% endif %}
              </div>
            </td>
          </tr>
          {% empty %}
          <tr>
            <td colspan="6" class="text-center text-muted py-4">No hay usuarios registrados.</td>
          </tr>
          {% endfor %}
        </tbody>
      </table>
    </div>
  </div>
</div>
{% endblock content %}
